<form id="userForm">
  <input type="text" id="name" placeholder="Your Name" required>
  <input type="text" id="message" placeholder="Your Message" required>
  <button type="submit">Send</button>
</form>

<div id="messages"></div>

<script>
  const form = document.getElementById('userForm');
  const messagesDiv = document.getElementById('messages');

  // Handle submit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const message = document.getElementById('message').value;

    const response = await fetch('/.netlify/functions/saveUser', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, message }),
    });

    const result = await response.json();
    alert(result.message);

    form.reset();
    loadMessages();
  });

  // Load all messages
  async function loadMessages() {
    const res = await fetch('/.netlify/functions/getUsers');
    const data = await res.json();
    messagesDiv.innerHTML = data
      .map(item => `<p><b>${item.name}</b>: ${item.message}</p>`)
      .join('');
  }

  loadMessages();
</script>
